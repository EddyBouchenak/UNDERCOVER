<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Undercover Mobile Pro</title>
    <style>
        :root {
            --bg-color: #0f0f1e;
            --card-bg: rgba(255, 255, 255, 0.08);
            --accent: #f1c40f;
            --green: #2ecc71;
            --red: #e74c3c;
            --blue: #3498db;
            --text: #ffffff;
            --safe-area-top: env(safe-area-inset-top);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }

        body {
            background-color: var(--bg-color);
            color: var(--text);
            font-family: -apple-system, system-ui, sans-serif;
            margin: 0; padding: 0;
            height: 100vh; display: flex; justify-content: center;
            overflow: hidden; touch-action: manipulation;
        }

        #app-container {
            width: 100%; max-width: 500px; height: 100%;
            display: flex; flex-direction: column;
            background-color: var(--bg-color);
            padding-top: var(--safe-area-top);
        }

        header {
            display: grid;
            grid-template-columns: 60px 1fr 60px;
            align-items: center;
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            flex-shrink: 0;
        }

        h1 { 
            grid-column: 2; 
            font-size: 1.4rem; 
            color: var(--accent); 
            margin: 0; 
            text-transform: uppercase; 
            letter-spacing: 2px;
            text-align: center;
        }

        #btn-home-icon {
            grid-column: 1;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            width: 40px; height: 40px;
            border-radius: 50%;
            font-size: 1.2rem;
            color: white;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
        }

        .view {
            flex-grow: 1; padding: 20px; display: none;
            flex-direction: column; overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        .view.active { display: flex; }

        button {
            border: none; border-radius: 16px; padding: 18px;
            font-size: 1.2rem; font-weight: 800; width: 100%;
            margin-bottom: 10px; transition: transform 0.05s, opacity 0.2s;
        }
        button:active { transform: scale(0.96); opacity: 0.8; }
        .btn-primary { background: var(--accent); color: #000; }
        .btn-green { background: var(--green); color: #fff; }
        .btn-red { background: var(--red); color: #fff; }
        .btn-blue { background: var(--blue); color: #fff; }

        input[type="text"] {
            width: 100%; padding: 16px; border-radius: 12px;
            border: 2px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.05); color: white;
            font-size: 1.1rem; margin-bottom: 10px; outline: none; text-align: center;
        }

        .card { background: var(--card-bg); border-radius: 20px; padding: 20px; margin-bottom: 15px; }

        .player-item {
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(255,255,255,0.05);
            padding: 16px 20px; border-radius: 12px; margin-bottom: 8px;
            border-left: 5px solid var(--blue);
        }

        .row { display: flex; align-items: center; justify-content: space-between; gap: 10px; }
        .spacer { flex-grow: 1; }
        .text-center { text-align: center; }

        .important-zoom {
            font-size: 2.8rem;
            font-weight: 900;
            color: var(--green);
            margin: 20px 0;
            display: block;
            text-align: center;
            text-shadow: 0 0 15px rgba(46, 204, 113, 0.3);
        }

        .distrib-label { font-size: 1.2rem; opacity: 0.7; margin-bottom: 5px; }

        .modal-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.94); z-index: 1000;
            display: none; flex-direction: column; justify-content: center;
            align-items: center; padding: 30px; backdrop-filter: blur(8px);
        }
        .modal-overlay.active { display: flex; }

        .setting-box { background: rgba(255,255,255,0.03); padding: 18px; border-radius: 18px; margin-bottom: 12px; }
        .counter-btn {
            background: var(--blue); color: white; width: 45px; height: 45px;
            border-radius: 14px; display: flex; align-items: center; justify-content: center;
            font-size: 1.4rem; font-weight: bold;
        }
    </style>
</head>
<body>

<div id="app-container">
    <header>
        <button id="btn-home-icon" onclick="confirmHome()">üè†</button>
        <h1>Undercover</h1>
    </header>

    <div id="view-setup" class="view active">
        <div class="card">
            <div class="row">
                <input type="text" id="new-player-input" placeholder="Pr√©nom du joueur..." autocomplete="off">
                <button class="btn-green" style="width: 70px; padding: 14px;" onclick="addPlayer()">+</button>
            </div>
        </div>
        <div id="players-list"></div>
        <div class="spacer"></div>
        <div id="setup-controls">
            <div id="score-setting-container" class="setting-box row">
                <span>üèÜ Objectif</span>
                <div class="row">
                    <div class="counter-btn" onclick="updateScoreLimit(-5)">-</div>
                    <span id="score-limit-display" style="min-width: 40px; text-align: center; font-weight: bold;">20</span>
                    <div class="counter-btn" onclick="updateScoreLimit(5)">+</div>
                </div>
            </div>
            <div id="role-setting-container" class="setting-box">
                <div class="row" style="margin-bottom: 15px;">
                    <span>üïµÔ∏è Undercovers</span>
                    <div class="row">
                        <div class="counter-btn" onclick="updateCount('undercover', -1)">-</div>
                        <span id="count-undercover" style="min-width: 30px; text-align: center;">1</span>
                        <div class="counter-btn" onclick="updateCount('undercover', 1)">+</div>
                    </div>
                </div>
                <div class="row">
                    <span>ü§° Mr. White</span>
                    <div class="row">
                        <div class="counter-btn" onclick="updateCount('white', -1)">-</div>
                        <span id="count-white" style="min-width: 30px; text-align: center;">0</span>
                        <div class="counter-btn" onclick="updateCount('white', 1)">+</div>
                    </div>
                </div>
            </div>
        </div>
        <button class="btn-primary" id="btn-start" onclick="startGame()" disabled>LANCER LA MANCHE</button>
    </div>

    <div id="view-distribution" class="view">
        <div class="spacer"></div>
        <div class="text-center">
            <div class="distrib-label">Au tour de</div>
            <div id="distrib-player-name" style="font-size: 3rem; color: var(--accent); font-weight: 900; margin-bottom: 10px;">Joueur</div>
            <p style="opacity: 0.6;">Regarde seul ton secret</p>
        </div>
        <div id="secret-area" style="display:none;" class="card text-center"></div>
        <div class="spacer"></div>
        <button id="btn-reveal" class="btn-red" onclick="revealSecret()">R√âV√âLER MON SECRET</button>
        <button id="btn-next-player" class="btn-blue" style="display:none;" onclick="nextDistribution()">JOUEUR SUIVANT</button>
    </div>

    <div id="view-game" class="view">
        <div class="card" style="border: 2px solid var(--green); background: rgba(46, 204, 113, 0.1);">
            <p id="starter-name-text" class="text-center" style="margin:0; font-weight: 900; font-size: 1.2rem;"></p>
        </div>
        <div id="game-players-list" style="margin-top: 15px;"></div>
    </div>

    <div id="view-gameover" class="view">
        <div id="grand-winner-area" style="display:none; background: linear-gradient(135deg, #f1c40f, #e67e22); color: black; padding: 25px; border-radius: 20px; font-weight: 800; margin-bottom: 20px; text-align: center;">
            üèÜ VICTOIRE FINALE<br>
            <span id="grand-winner-name" style="font-size: 2.2rem;"></span>
        </div>
        <div class="card text-center">
            <h2 id="winner-message" style="margin: 0 0 20px 0; color: var(--accent); font-size: 1.8rem;"></h2>
            <div style="text-align: center; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px;">
                <div style="margin-bottom: 15px;">
                    <span style="opacity: 0.7;">Mot Civil :</span><br>
                    <b style="color: var(--green); font-size: 2.2rem;" id="civil-word-reveal"></b>
                </div>
                <div>
                    <span style="opacity: 0.7;">Mot Undercover :</span><br>
                    <b style="color: var(--red); font-size: 2.2rem;" id="under-word-reveal"></b>
                </div>
            </div>
        </div>
        <div id="scores-list"></div>
        <div class="spacer"></div>
        <button id="btn-next-round" class="btn-primary" onclick="resetGame(false)">MANCHE SUIVANTE</button>
        <button id="btn-reset-all" class="btn-red" style="display:none;" onclick="resetGame(true)">NOUVELLE PARTIE</button>
    </div>

    <div id="home-confirm-modal" class="modal-overlay">
        <div class="card" style="width: 100%; text-align: center;">
            <h3>Quitter la partie ?</h3>
            <button class="btn-red" onclick="goHome()">OUI, QUITTER</button>
            <button class="btn-blue" onclick="closeHomeModal()">ANNULER</button>
        </div>
    </div>

    <div id="mr-white-modal" class="modal-overlay">
        <div class="card" style="width: 100%; text-align: center;">
            <h2 style="color: var(--red);">D√âMASQU√â !</h2>
            <p><b id="white-name" style="color:var(--accent)"></b>, devine le mot des civils :</p>
            <input type="text" id="white-guess-input" placeholder="Ton guess..." autocomplete="off">
            <button class="btn-green" onclick="validateWhiteGuess()">VALIDER</button>
        </div>
    </div>
</div>

<script>
    const database = [
        ["Guitare", "Violon"], ["Bi√®re", "Cidre"], ["Lion", "Tigre"], ["Pomme", "Poire"], ["Plage", "Piscine"], ["Facebook", "Twitter"], ["Harry Potter", "Seigneur des Anneaux"], ["McDonald's", "Burger King"], ["Paris", "Londres"], ["Soleil", "Lune"], ["Chien", "Chat"], ["Voiture", "Moto"], ["Th√©", "Caf√©"], ["Foot", "Rugby"], ["Piano", "Clavier"], ["Stylo", "Crayon"], ["Montre", "Horloge"], ["Bateau", "Paquebot"], ["Avion", "H√©licopt√®re"], ["Pantalon", "Short"], ["Chemise", "T-shirt"], ["Lunettes", "Lentilles"], ["Chaise", "Tabouret"], ["Lit", "Canap√©"], ["Douche", "Bain"], ["Banane", "Kiwi"], ["Orange", "Cl√©mentine"], ["Or", "Argent"], ["Diamant", "Rubis"], ["Coca", "Pepsi"], ["Netflix", "YouTube"], ["Uber", "Taxi"], ["Chocolat", "Vanille"], ["Pain", "Brioche"], ["Pizza", "P√¢tes"], ["Fromage", "Yaourt"], ["Vin", "Champagne"], ["No√´l", "Nouvel An"], ["Mariage", "PACS"], ["√âcole", "Universit√©"], ["Professeur", "√âl√®ve"], ["Docteur", "Infirmier"], ["Police", "Pompier"], ["Roi", "Pr√©sident"], ["Ch√¢teau", "Manoir"], ["For√™t", "Jungle"], ["Montagne", "Colline"], ["Neige", "Glace"], ["Pluie", "Orage"], ["Vent", "Temp√™te"], ["Rivi√®re", "Fleuve"], ["D√©sert", "Plage"], ["Volcan", "Montagne"], ["Cin√©ma", "Th√©√¢tre"], ["Bar", "Bo√Æte de nuit"], ["Biblioth√®que", "Librairie"], ["Mus√©e", "Galerie"], ["H√¥tel", "Camping"], ["Prison", "Cachot"], ["Abeille", "Gu√™pe"], ["Crocodile", "Alligator"], ["Chouette", "Hibou"], ["Cheval", "Poney"], ["Lapin", "Li√®vre"], ["Dauphin", "Requin"], ["Aigle", "Faucon"], ["Moustique", "Mouche"], ["Loup", "Renard"], ["Superman", "Batman"], ["P√®re No√´l", "Lutin"], ["Vampire", "Loup-garou"], ["Ange", "D√©mon"], ["Sorcier", "Magicien"], ["Pirate", "Marin"], ["Ninja", "Samoura√Ø"], ["Savon", "Shampoing"], ["Brosse √† dents", "Dentifrice"], ["Four", "Micro-ondes"], ["Frigo", "Cong√©lateur"], ["Lampe", "Bougie"], ["Miroir", "Vitre"], ["Cl√©", "Serrure"], ["Ketchup", "Mayonnaise"], ["Sel", "Poivre"], ["Sucre", "Miel"], ["Cr√™pe", "Gaufre"], ["Pain au chocolat", "Chocolatine"], ["Sushi", "Maki"], ["Riz", "P√¢te"], ["Salade", "√âpinard"], ["Eau plate", "Eau gazeuse"], ["Thon", "Saumon"], ["Poulet", "Dinde"],
        ["Tapis", "Moquette"], ["Rideau", "Store"], ["Coussin", "Oreiller"], ["Valise", "Sac √† dos"], ["Montre", "Chrono"], ["Bracelet", "Bague"], ["Collier", "Pendentif"], ["Casquette", "Bonnet"], ["Gants", "Moufle"], ["√âcharpe", "Foulard"], ["Parapluie", "Parasol"], ["Savon", "Gel douche"], ["Mousse", "Cr√®me"], ["Rasoir", "Tondeuse"], ["Miroir", "Glace"], ["Peigne", "Brosse"], ["S√®che-cheveux", "Lisseur"], ["Ciseaux", "Cutter"], ["Colle", "Scotch"], ["Marteau", "Tournevis"], ["Clou", "Vis"], ["Pince", "Tenaille"], ["Scie", "Hache"], ["Pelle", "R√¢teau"], ["Arrosoir", "Tuyau"], ["Gazon", "Pelouse"], ["Fleur", "Plante"], ["Arbre", "Arbuste"], ["For√™t", "Bois"], ["Mer", "Oc√©an"], ["Lac", "√âtang"], ["Vague", "Mar√©e"], ["Sable", "Galet"], ["Coquillage", "Crustac√©"], ["Poisson", "Baleine"], ["Oiseau", "Papillon"], ["Fourmi", "Araign√©e"], ["Singe", "Gorille"], ["√âl√©phant", "Rhinoc√©ros"], ["Girafe", "Z√®bre"], ["Ours", "Panda"], ["Pingouin", "Manchot"], ["Kangourou", "Koala"], ["Vache", "Taureau"], ["Mouton", "Ch√®vre"], ["Cochon", "Sanglier"], ["Canard", "Oie"], ["Poule", "Coq"], ["Souris", "Rat"], ["Hamster", "Cochon d'inde"], ["Serpent", "L√©zard"], ["Tortue", "Grenouille"], ["Escargot", "Limace"], ["Livre", "Magazine"], ["Journal", "BD"], ["Roman", "Po√©sie"], ["Dessin", "Peinture"], ["Photo", "Vid√©o"], ["Cam√©ra", "Appareil photo"], ["Radio", "Podcasts"], ["Musique", "Chant"], ["Danse", "Ballet"], ["Op√©ra", "Cirque"], ["Magie", "Illusion"], ["Jeu", "Jouet"], ["Poup√©e", "Figurine"], ["Puzzle", "Lego"], ["Cartes", "D√©s"], ["√âchecs", "Dames"], ["Billard", "Bowling"], ["Fl√©chettes", "Ping-pong"], ["Tennis", "Badminton"], ["Basket", "Handball"], ["V√©lo", "VTT"], ["Ski", "Surf"], ["Luge", "Patin"], ["Boxe", "Karat√©"], ["Yoga", "Pilates"], ["Course", "Marche"], ["Nage", "Plong√©e"], ["P√™che", "Chasse"], ["Cuisine", "P√¢tisserie"], ["Recette", "Menu"], ["Restaurant", "Bistro"], ["Caf√©", "Taverne"], ["Boulangerie", "P√¢tisserie"], ["Boucherie", "Charcuterie"], ["√âpicerie", "March√©"], ["Supermarch√©", "Hypermarch√©"], ["Boutique", "Magasin"], ["Centre commercial", "Galerie"], ["Mairie", "Pr√©fecture"], ["Banque", "Assurance"], ["Poste", "Courrier"], ["Lettre", "Colis"], ["Timbre", "Enveloppe"], ["T√©l√©phone", "Smartphone"], ["Tablette", "Ordinateur"], ["√âcran", "Moniteur"], ["Souris", "Clavier"], ["Imprimante", "Scanner"], ["Internet", "Wifi"], ["Site", "Blog"], ["Email", "SMS"], ["Mot de passe", "Identifiant"], ["Logiciel", "Appli"], ["Fen√™tre", "Porte"], ["Toit", "Mur"], ["Sol", "Plafond"], ["Escalier", "Ascenseur"], ["Balcon", "Terrasse"], ["Jardin", "Cour"], ["Garage", "Parking"], ["Cave", "Grenier"], ["Cuisine", "Salon"], ["Chambre", "Bureau"], ["Bain", "Toilette"], ["√âvier", "Lavabo"], ["Robinet", "Pommeau"], ["Prise", "Interrupteur"], ["Ampoule", "N√©on"], ["Radiateur", "Po√™le"], ["Clim", "Ventilo"], ["Balai", "Aspirateur"], ["Chiffon", "√âponge"], ["Seau", "Bassine"], ["Lessive", "Adoucissant"], ["Fer √† repasser", "Vapeur"], ["Casserole", "Po√™le"], ["Marmite", "Wok"], ["Plat", "Assiette"], ["Verre", "Coupe"], ["Fourchette", "Cuill√®re"], ["Couteau", "Lame"], ["Serviette", "Nappe"], ["Pain", "Baguette"], ["Beurre", "Margarine"], ["Lait", "Cr√®me"], ["Oeuf", "Omelette"], ["Farine", "Semoule"], ["P√¢te", "Nouille"], ["Riz", "Grain"], ["Pomme de terre", "Frites"], ["Carotte", "Navet"], ["Tomate", "Poivron"], ["Oignon", "Ail"], ["Herbe", "√âpice"], ["Sel", "Gros sel"], ["Poivre", "Piment"], ["Huile", "Vinaigre"], ["Moutarde", "Raifort"], ["Confiture", "Gel√©e"], ["Miel", "Sirop"], ["G√¢teau", "Tarte"], ["Biscuit", "Cookie"], ["Bonbon", "Sucette"], ["Glace", "Sorbet"], ["Fruit", "L√©gume"], ["Jus", "Sirop"], ["Soda", "Limonade"], ["Cocktail", "Mocktail"], ["Alcool", "Spiritueux"], ["Rhum", "Whisky"], ["Vodka", "Gin"], ["Tequila", "Mezcal"], ["Lundi", "Mardi"], ["Matin", "Soir"], ["Jour", "Nuit"], ["Heure", "Minute"], ["Seconde", "Instant"], ["Hier", "Demain"], ["Semaine", "Mois"], ["Ann√©e", "Si√®cle"], ["Printemps", "Automne"], ["√ât√©", "Hiver"], ["Chaud", "Froid"], ["Sec", "Humide"], ["Vite", "Lent"], ["Grand", "Petit"], ["Gros", "Mince"], ["Beau", "Joli"], ["Fort", "Puissant"], ["Riche", "Fortun√©"], ["Jeune", "Vieux"], ["Nouveau", "Ancien"], ["Premier", "Dernier"], ["Vrai", "R√©el"], ["Bon", "Excellent"], ["Mieux", "Meilleur"]
    ];

    let players = [], config = { undercovers: 1, whites: 0, winningScore: 20 }, currentCivilWord = "", currentUnderWord = "", distributionIndex = 0, playerBeingEliminated = null, gameInProgress = false;

    function addPlayer() {
        const input = document.getElementById('new-player-input');
        const name = input.value.trim();
        if (name) {
            players.push({ id: Date.now()+Math.random(), name, role: null, word: null, eliminated: false, score: 0, lastPoints: 0, isStarter: false });
            input.value = ""; renderPlayersList(); autoAdjustRoles();
        }
    }

    function renderPlayersList() {
        const list = document.getElementById('players-list');
        list.innerHTML = players.map(p => `<div class="player-item"><b>${p.name}</b><span>${p.score} pts</span></div>`).join('');
        document.getElementById('btn-start').disabled = players.length < 3;
    }

    function updateCount(type, delta) {
        if (type === 'undercover') config.undercovers = Math.max(0, Math.min(5, config.undercovers + delta));
        else config.whites = Math.max(0, Math.min(5, config.whites + delta));
        document.getElementById('count-undercover').innerText = config.undercovers;
        document.getElementById('count-white').innerText = config.whites;
    }

    function updateScoreLimit(delta) {
        config.winningScore = Math.max(5, config.winningScore + delta);
        document.getElementById('score-limit-display').innerText = config.winningScore;
    }

    function autoAdjustRoles() {
        const total = players.length;
        config.undercovers = total <= 5 ? 1 : total <= 8 ? 2 : 3;
        document.getElementById('count-undercover').innerText = config.undercovers;
    }

    function startGame() {
        gameInProgress = true;
        players.forEach(p => { p.eliminated = false; p.lastPoints = 0; p.isStarter = false; });
        
        const pair = database[Math.floor(Math.random() * database.length)];
        currentCivilWord = pair[0]; currentUnderWord = pair[1];

        let roles = [];
        for(let i=0; i<config.undercovers; i++) roles.push('Undercover');
        for(let i=0; i<config.whites; i++) roles.push('Mr. White');
        while(roles.length < players.length) roles.push('Civil');
        roles.sort(() => Math.random() - 0.5);

        players.forEach((p, i) => {
            p.role = roles[i];
            p.word = (p.role === 'Civil') ? currentCivilWord : (p.role === 'Undercover' ? currentUnderWord : null);
        });

        distributionIndex = 0; switchView('view-distribution'); updateDistributionView();
    }

    function updateDistributionView() {
        const p = players[distributionIndex];
        document.getElementById('distrib-player-name').innerText = p.name;
        document.getElementById('secret-area').style.display = 'none';
        document.getElementById('btn-reveal').style.display = 'block';
        document.getElementById('btn-next-player').style.display = 'none';
    }

    function revealSecret() {
        const p = players[distributionIndex];
        const area = document.getElementById('secret-area');
        area.style.display = 'block';
        area.innerHTML = p.role === 'Mr. White' ? 
            `<div class="important-zoom" style="color:var(--red)">MR. WHITE</div>` : 
            `<div style="font-size:1.1rem; opacity:0.8; margin-top:10px;">Ton mot secret :</div>
             <div class="important-zoom">${p.word}</div>`;
        document.getElementById('btn-reveal').style.display = 'none';
        document.getElementById('btn-next-player').style.display = 'block';
    }

    function nextDistribution() {
        if (++distributionIndex < players.length) updateDistributionView();
        else { 
            const civils = players.filter(p => p.role === 'Civil');
            civils[Math.floor(Math.random() * civils.length)].isStarter = true;
            switchView('view-game'); 
            setupGameView(); 
        }
    }

    function setupGameView() {
        const starter = players.find(p => p.isStarter);
        document.getElementById('starter-name-text').innerText = `üåü ${starter.name} COMMENCE !`;
        renderGamePlayers();
    }

    function renderGamePlayers() {
        document.getElementById('game-players-list').innerHTML = players.map(p => `
            <div class="player-item" style="${p.eliminated ? 'opacity:0.4; border-color:var(--red)' : ''}">
                <div><b style="font-size:1.2rem">${p.name}</b> ${p.eliminated ? `<br><small style="color:var(--red)">${p.role.toUpperCase()}</small>` : ''}</div>
                ${!p.eliminated ? `<button class="btn-red" style="width:auto; padding:10px 20px; margin:0;" onclick="attemptEliminate('${p.id}')">VOTER</button>` : '<span>‚ùå</span>'}
            </div>`).join('');
    }

    function attemptEliminate(id) {
        const p = players.find(x => x.id == id);
        playerBeingEliminated = p;
        if (p.role === 'Mr. White') {
            document.getElementById('white-name').innerText = p.name;
            document.getElementById('white-guess-input').value = "";
            document.getElementById('mr-white-modal').classList.add('active');
        } else confirmElimination(p);
    }

    function validateWhiteGuess() {
        const guess = document.getElementById('white-guess-input').value.trim().toLowerCase();
        document.getElementById('mr-white-modal').classList.remove('active');
        if (guess === currentCivilWord.toLowerCase()) {
            playerBeingEliminated.score += 6; playerBeingEliminated.lastPoints = 6;
            endGame(`üé© MR. WHITE (${playerBeingEliminated.name}) A GAGN√â !`);
        } else confirmElimination(playerBeingEliminated);
    }

    function confirmElimination(p) {
        p.eliminated = true; renderGamePlayers(); checkWinCondition();
    }

    function checkWinCondition() {
        const active = players.filter(p => !p.eliminated);
        const impostors = active.filter(p => p.role !== 'Civil').length;
        const civils = active.filter(p => p.role === 'Civil').length;
        const undercovers = active.filter(p => p.role === 'Undercover').length;

        // R√àGLE : 1 Undercover vs 1 Civil = Victoire Undercover
        if (active.length === 2 && undercovers === 1 && civils === 1) {
            active.filter(p => p.role === 'Undercover').forEach(p => { p.score += 10; p.lastPoints = 10; });
            endGame("üïµÔ∏è VICTOIRE UNDERCOVER (Duel final !)");
            return;
        }

        if (impostors === 0) {
            players.filter(p => !p.eliminated).forEach(p => { p.score += 2; p.lastPoints = 2; });
            endGame("üéâ VICTOIRE DES CIVILS !");
        } else if (civils === 0) {
            players.filter(p => !p.eliminated && p.role === 'Undercover').forEach(p => { p.score += 10; p.lastPoints = 10; });
            endGame("üïµÔ∏è VICTOIRE IMPOSTEURS !");
        }
    }

    function endGame(msg) {
        document.getElementById('winner-message').innerText = msg;
        document.getElementById('civil-word-reveal').innerText = currentCivilWord;
        document.getElementById('under-word-reveal').innerText = currentUnderWord;
        const sorted = [...players].sort((a,b) => b.score - a.score);
        const winner = sorted.find(p => p.score >= config.winningScore);
        
        if (winner) {
            gameInProgress = false;
            document.getElementById('grand-winner-area').style.display = 'block';
            document.getElementById('grand-winner-name').innerText = winner.name.toUpperCase();
            document.getElementById('btn-next-round').style.display = 'none';
            document.getElementById('btn-reset-all').style.display = 'block';
        } else {
            document.getElementById('grand-winner-area').style.display = 'none';
            document.getElementById('btn-next-round').style.display = 'block';
            document.getElementById('btn-reset-all').style.display = 'none';
        }

        document.getElementById('scores-list').innerHTML = sorted.map(p => `
            <div class="player-item">
                <div><b>${p.name}</b><br><small style="opacity:0.6">${p.role}</small></div>
                <div style="text-align:right"><b>${p.score} / ${config.winningScore}</b>${p.lastPoints ? `<br><small style="color:var(--green)">+${p.lastPoints}</small>` : ''}</div>
            </div>`).join('');
        switchView('view-gameover');
    }

    function resetGame(full) {
        if (full) { players.forEach(p => p.score = 0); gameInProgress = false; }
        document.getElementById('score-setting-container').style.display = gameInProgress ? 'none' : 'flex';
        document.getElementById('role-setting-container').style.display = gameInProgress ? 'none' : 'block';
        if (!full && gameInProgress) startGame(); else { switchView('view-setup'); renderPlayersList(); }
    }

    function switchView(id) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function confirmHome() { document.getElementById('home-confirm-modal').classList.add('active'); }
    function closeHomeModal() { document.getElementById('home-confirm-modal').classList.remove('active'); }
    function goHome() { closeHomeModal(); resetGame(true); }
</script>
</body>
</html>